<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚´ãƒ«ãƒ•ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯ ã‚¹ã‚³ã‚¢</title>
<meta name="description" content="ã‚´ãƒ«ãƒ•ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯å½¢å¼ã®ã‚¹ã‚³ã‚¢ç®¡ç†ã‚¢ãƒ—ãƒª">
<meta name="theme-color" content="#16a34a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Golf Olympic">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,-apple-system,sans-serif;background:linear-gradient(to bottom,#f0fdf4,#dbeafe);min-height:100vh;padding-bottom:120px}
.container{max-width:1024px;margin:0 auto;padding:16px}
.card{background:white;border-radius:24px;padding:24px;margin-bottom:24px;box-shadow:0 4px 6px rgba(0,0,0,0.1)}
h1{font-size:24px;font-weight:bold;text-align:center;margin-bottom:24px}
h2{font-size:20px;font-weight:bold;margin-bottom:16px}
.label{display:block;font-weight:bold;margin-bottom:12px}
.grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.grid-5{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.hole-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch}
.hole-row{display:flex;gap:8px;min-width:min-content;padding-bottom:4px}
.btn{border:none;padding:12px;border-radius:12px;font-weight:bold;cursor:pointer;font-size:16px;background:#f3f4f6}
.btn-hole{position:relative;min-width:60px;flex-shrink:0}
.btn-hole.active{background:#16a34a;color:white}
.dot{position:absolute;width:8px;height:8px;border-radius:50%}
.dot-top{top:4px;right:4px;background:#06b6d4}
.dot-bottom{bottom:4px;right:4px;background:#a855f7}
.btn-player{display:flex;align-items:center;gap:12px;padding:16px}
.btn-player.active{background:#2563eb;color:white}
.avatar{font-size:24px}
.btn-score{padding:0;position:relative;color:white;aspect-ratio:1;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60px;font-size:11px}
.btn-score.selected{box-shadow:0 0 0 4px #16a34a}
.bg-yellow-400{background:#facc15}.bg-gray-300{background:#d1d5db}.bg-orange-600{background:#ea580c}.bg-gray-600{background:#4b5563}.bg-blue-400{background:#60a5fa}.bg-green-400{background:#4ade80}.bg-purple-400{background:#c084fc}.bg-yellow-700{background:#a16207}.bg-red-400{background:#f87171}.bg-amber-200{background:#fde68a}.bg-green-600{background:#16a34a}.bg-blue-300{background:#93c5fd}.bg-gray-400{background:#9ca3af}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #e5e7eb;padding:8px;text-align:center;font-size:14px}
th{background:#f3f4f6;font-weight:bold}
.bg-cyan-100{background:#cffafe}.bg-purple-100{background:#f3e8ff}.bg-green-100{background:#dcfce7;color:#166534}.bg-red-100{background:#fee2e2;color:#991b1b}.bg-blue-100{background:#dbeafe}.bg-yellow-100{background:#fef3c7}
td.clickable{cursor:pointer}
td.clickable:hover{background:#bfdbfe}
.nav{position:fixed;bottom:0;left:0;right:0;background:white;border-top:2px solid #e5e7eb;display:flex;justify-content:space-around;padding:20px 16px;z-index:99999;box-shadow:0 -2px 10px rgba(0,0,0,0.1)}
.nav-btn{display:flex;flex-direction:column;align-items:center;gap:4px;border:none;background:none;cursor:pointer;color:#9ca3af;padding:8px;min-width:80px}
.nav-btn.active{color:#16a34a}
.nav-btn svg{width:28px;height:28px}
.nav-btn span{font-size:13px;font-weight:600}
input,select{padding:12px;border:1px solid #e5e7eb;border-radius:8px;font-size:16px}
.input-full{width:100%}
.flex{display:flex}.flex-gap{gap:8px}.mb-6{margin-bottom:24px}.space-y{display:flex;flex-direction:column;gap:12px}
.bg-gray-50{background:#f9fafb;border-radius:24px;padding:24px}
.btn-primary{background:#2563eb;color:white;padding:14px 24px;border-radius:12px;border:none;cursor:pointer;font-weight:bold;font-size:16px}
.btn-secondary{background:#e5e7eb;color:#374151;padding:14px 24px;border-radius:12px;border:none;cursor:pointer;font-weight:bold;font-size:16px}
.btn-count{padding:12px 24px}.btn-count.active{background:#2563eb;color:white}
.btn-reset{background:#f97316;color:white;padding:16px;border-radius:16px;width:100%;border:none;cursor:pointer;font-weight:bold;font-size:16px}
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:100000;padding:20px}
.modal-content{background:white;border-radius:24px;padding:24px;max-width:500px;width:100%;max-height:80vh;overflow-y:auto}
.preset-item{background:#f3f4f6;padding:20px;border-radius:16px;margin-bottom:16px;border:2px solid #e5e7eb}
.preset-name{font-weight:bold;margin-bottom:12px;font-size:18px;color:#1f2937}
.preset-btns{display:flex;gap:12px;margin-top:12px}
.btn-load{background:#2563eb;color:white;padding:14px;border-radius:10px;border:none;cursor:pointer;font-weight:bold;flex:1;font-size:16px}
.btn-del{background:#ef4444;color:white;padding:14px;border-radius:10px;border:none;cursor:pointer;font-weight:bold;font-size:16px;min-width:80px}
.alert{position:fixed;top:80px;left:50%;transform:translateX(-50%);background:#16a34a;color:white;padding:20px 32px;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,0.3);z-index:200000;font-weight:bold;font-size:18px;max-width:90%;text-align:center}
.overflow-x{overflow-x:auto}
</style>
</head>
<body>
<div id="app"></div>
<script type="module">
// Firebase SDK
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, set, onValue, off } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

const firebaseConfig = {
  apiKey: "AIzaSyCFD2IFYU34YK6Z_PRs2pTuZ-WZIj9Vy6M",
  authDomain: "golf-olympic.firebaseapp.com",
  databaseURL: "https://golf-olympic-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "golf-olympic",
  storageBucket: "golf-olympic.firebasestorage.app",
  messagingSenderId: "631997493044",
  appId: "1:631997493044:web:0a3f55657ac942d9fdff61"
};

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);
window.fbDB = database;
window.fbRef = ref;
window.fbSet = set;
window.fbOnValue = onValue;
window.fbOff = off;
</script>
<script>
let D={hole:1,player:1,scores:{},view:'input',nph:{},dch:{},rid:null,cfg:{courseName:'',date:new Date().toISOString().split('T')[0],cnt:4,names:['P1','P2','P3','P4'],avs:['ğŸ‘¨','ğŸ‘©','ğŸ‘¨â€ğŸ’¼','ğŸ‘©â€ğŸ’¼'],pts:{gold:3,silver:2,bronze:1,iron:0,diamond:5,nearpin:1,dracon:1,eagle:3,birdie:1,sand:-1,flag:1,threeputt:-1},nikaiNearpin:false,nikaiDracon:false},showPresets:false,showSaveForm:false,showRounds:false,showApiSetup:false,showRoundIdInput:false,showAvatarPicker:false,avatarPickerIndex:null,alert:null,apiUrl:localStorage.getItem('sheets_api_url')||''};
const AVATARS=['ğŸ‘¨','ğŸ‘©','ğŸ‘¦','ğŸ‘§','ğŸ‘´','ğŸ‘µ','ğŸ‘¶','ğŸ§’','ğŸ§‘','ğŸ‘¨â€ğŸ’¼','ğŸ‘©â€ğŸ’¼','ğŸ‘¨â€âš•ï¸','ğŸ‘©â€âš•ï¸','ğŸ‘¨â€ğŸ“','ğŸ‘©â€ğŸ“','ğŸ‘¨â€ğŸ«','ğŸ‘©â€ğŸ«','ğŸ‘¨â€âš–ï¸','ğŸ‘©â€âš–ï¸','ğŸ‘¨â€ğŸŒ¾','ğŸ‘©â€ğŸŒ¾','ğŸ§”','ğŸ¤µ','ğŸ‘°','ğŸ…','ğŸ¤¶','ğŸ¦¸','ğŸ¦¹','â›³','ğŸŒï¸'];
function newRound(){D.rid='round_'+Date.now();D.scores={};console.log('æ–°è¦ãƒ©ã‚¦ãƒ³ãƒ‰ä½œæˆ:',D.rid);saveRound();startRealtimeSync();alert('âœ… æ–°è¦ãƒ©ã‚¦ãƒ³ãƒ‰ä½œæˆ\n\nãƒ©ã‚¦ãƒ³ãƒ‰IDã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨å…±æœ‰ã—ã¦ãã ã•ã„')}
function joinRound(){const rid=document.getElementById('roundIdInput').value.trim();if(!rid){alert('âŒ ãƒ©ã‚¦ãƒ³ãƒ‰IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');return}if(window.fbDB){const roundRef=window.fbRef(window.fbDB,'rounds/'+rid);window.fbOnValue(roundRef,(snapshot)=>{const data=snapshot.val();if(data){console.log('Firebaseèª­è¾¼:',data);D.rid=rid;D.cfg=data.cfg||D.cfg;D.scores=data.scores||{};D.nph=data.nph||{};D.dch=data.dch||{};const list=JSON.parse(localStorage.getItem('rounds_list')||'[]');const exists=list.find(x=>x.id===rid);if(!exists){list.unshift({id:rid,courseName:D.cfg.courseName||'æœªè¨­å®š',date:D.cfg.date,updatedAt:data.updatedAt||Date.now()});localStorage.setItem('rounds_list',JSON.stringify(list))}D.showRoundIdInput=false;startRealtimeSync();alert('âœ… ãƒ©ã‚¦ãƒ³ãƒ‰ã«å‚åŠ ã—ã¾ã—ãŸ\n\nã‚¹ã‚³ã‚¢ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åŒæœŸã•ã‚Œã¾ã™');render()}else{alert('âŒ ãƒ©ã‚¦ãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: '+rid)}},{onlyOnce:true})}else{alert('âŒ Firebaseæ¥ç¶šã‚¨ãƒ©ãƒ¼')}}
let realtimeListener=null;
function startRealtimeSync(){if(realtimeListener){window.fbOff(realtimeListener)}if(!D.rid||!window.fbDB)return;const roundRef=window.fbRef(window.fbDB,'rounds/'+D.rid);realtimeListener=roundRef;window.fbOnValue(roundRef,(snapshot)=>{const data=snapshot.val();if(data){console.log('ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°:',data);const oldScores=JSON.stringify(D.scores);D.cfg=data.cfg||D.cfg;D.scores=data.scores||{};D.nph=data.nph||{};D.dch=data.dch||{};if(JSON.stringify(D.scores)!==oldScores){console.log('ã‚¹ã‚³ã‚¢å¤‰æ›´æ¤œçŸ¥');render()}}})}
function stopRealtimeSync(){if(realtimeListener&&window.fbOff){window.fbOff(realtimeListener);realtimeListener=null}}
async function saveRound(){
  if(!D.rid){console.log('ã‚¨ãƒ©ãƒ¼: ridãŒnull');return}
  const r={
    id:D.rid,
    courseName:D.cfg.courseName,
    date:D.cfg.date,
    players:D.cfg.names.slice(0,D.cfg.cnt),
    cfg:D.cfg,
    scores:JSON.parse(JSON.stringify(D.scores)),
    nph:D.nph,
    dch:D.dch,
    updatedAt:Date.now()
  };
  console.log('ãƒ©ã‚¦ãƒ³ãƒ‰ä¿å­˜:',r);
  
  // Firebase Realtime Database ã«ä¿å­˜
  if(window.fbDB){
    try{
      const roundRef = window.fbRef(window.fbDB, 'rounds/' + D.rid);
      await window.fbSet(roundRef, r);
      console.log('Firebaseä¿å­˜å®Œäº†');
    }catch(err){
      console.log('Firebaseä¿å­˜ã‚¨ãƒ©ãƒ¼:',err);
    }
  }
  
  // Google Sheets ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
  if(D.apiUrl){
    try{
      const formData=new URLSearchParams();
      formData.append('action','saveRound');
      formData.append('roundId',D.rid);
      formData.append('data',JSON.stringify(r));
      await fetch(D.apiUrl,{method:'POST',body:formData,mode:'no-cors'});
      console.log('Sheetsä¿å­˜å®Œäº†');
    }catch(err){
      console.log('Sheetsä¿å­˜ã‚¨ãƒ©ãƒ¼:',err);
    }
  }
  
  // LocalStorage ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
  localStorage.setItem(D.rid,JSON.stringify(r));
  const list=JSON.parse(localStorage.getItem('rounds_list')||'[]');
  const idx=list.findIndex(x=>x.id===D.rid);
  const item={id:D.rid,courseName:D.cfg.courseName||'æœªè¨­å®š',date:D.cfg.date,updatedAt:r.updatedAt};
  if(idx>-1)list[idx]=item;else list.unshift(item);
  localStorage.setItem('rounds_list',JSON.stringify(list));
  console.log('ãƒ©ã‚¦ãƒ³ãƒ‰ãƒªã‚¹ãƒˆ:',list);
}
async function loadRound(id){console.log('ãƒ©ã‚¦ãƒ³ãƒ‰èª­è¾¼é–‹å§‹:',id);if(!id){console.log('ã‚¨ãƒ©ãƒ¼: idãŒç©º');return}let r=JSON.parse(localStorage.getItem(id));console.log('localStorageã‹ã‚‰èª­è¾¼:',r);if(!r){console.log('ã‚¨ãƒ©ãƒ¼: ãƒ‡ãƒ¼ã‚¿ãªã—');return}D.rid=id;D.scores=r.scores||{};if(r.cfg){D.cfg=r.cfg}if(r.nph){D.nph=r.nph}if(r.dch){D.dch=r.dch}console.log('èª­è¾¼å®Œäº† rid:',D.rid,'scores:',D.scores);startRealtimeSync();render();alert('âœ… ãƒ©ã‚¦ãƒ³ãƒ‰èª­è¾¼')}
async function deleteRound(id){console.log('ãƒ©ã‚¦ãƒ³ãƒ‰å‰Šé™¤:',id);if(D.apiUrl){try{const formData=new URLSearchParams();formData.append('action','deleteRound');formData.append('roundId',id);await fetch(D.apiUrl,{method:'POST',body:formData,mode:'no-cors'})}catch(err){console.log('Sheetså‰Šé™¤ã‚¨ãƒ©ãƒ¼:',err)}}localStorage.removeItem(id);const list=JSON.parse(localStorage.getItem('rounds_list')||'[]');localStorage.setItem('rounds_list',JSON.stringify(list.filter(x=>x.id!==id)));if(D.rid===id){newRound()}else{render()}alert('âœ… ãƒ©ã‚¦ãƒ³ãƒ‰å‰Šé™¤')}
async function syncFromSheets(){alert('âŒ Sheetsé€£æºã¯ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚èª­è¾¼æ©Ÿèƒ½ã¯ä»Šå¾Œè¿½åŠ äºˆå®šã§ã™ã€‚')}
function setApiUrl(){const url=document.getElementById('apiUrlInput').value.trim();if(url){D.apiUrl=url;localStorage.setItem('sheets_api_url',url);D.showApiSetup=false;alert('âœ… API URLè¨­å®šå®Œäº†\n\nã‚¹ã‚³ã‚¢å…¥åŠ›æ™‚ã«è‡ªå‹•çš„ã«Google Sheetsã«ä¿å­˜ã•ã‚Œã¾ã™');render()}else{alert('âŒ URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')}}
const T=[{id:'gold',l:'é‡‘',c:'bg-yellow-400',g:'rank',icon:'ğŸ¥‡'},{id:'silver',l:'éŠ€',c:'bg-gray-300',g:'rank',icon:'ğŸ¥ˆ'},{id:'bronze',l:'éŠ…',c:'bg-orange-600',g:'rank',icon:'ğŸ¥‰'},{id:'iron',l:'é‰„',c:'bg-gray-600',g:'rank',icon:'âš«'},{id:'diamond',l:'ãƒ€ã‚¤ãƒ¤',c:'bg-blue-400',g:'rank',icon:'ğŸ’'},{id:'nearpin',l:'ãƒ‹ã‚¢ãƒ”ãƒ³',c:'bg-green-400',g:'special',icon:'ğŸ¯'},{id:'dracon',l:'ãƒ‰ãƒ©ã‚³ãƒ³',c:'bg-purple-400',g:'special',icon:'ğŸŒï¸'},{id:'eagle',l:'ã‚¤ãƒ¼ã‚°ãƒ«',c:'bg-yellow-700',g:'score',icon:'ğŸ¦…'},{id:'birdie',l:'ãƒãƒ¼ãƒ‡ã‚£ãƒ¼',c:'bg-red-400',g:'score',icon:'ğŸ¦'},{id:'sand',l:'ç ‚',c:'bg-amber-200',g:'other',icon:'â›±ï¸'},{id:'flag',l:'æ——',c:'bg-green-600',g:'other',icon:'ğŸš©'},{id:'threeputt',l:'3ãƒ‘ãƒƒãƒˆ',c:'bg-blue-300',g:'other',icon:'â›³'},{id:'none',l:'ãªã—',c:'bg-gray-400',g:'none',icon:'âŒ'}];
function alert(m){D.alert=m;render();setTimeout(()=>{D.alert=null;render()},3000)}
function save(){saveRound()}
const MEDALS=['gold','silver','bronze','iron'];
function isMedalTaken(hole,medal,currentPlayer){for(let p=1;p<=D.cfg.cnt;p++){if(p===currentPlayer)continue;const scores=D.scores['h'+hole+'_p'+p]||[];if(scores.includes(medal))return p}return false}
function rec(t){const k='h'+D.hole+'_p'+D.player;if(!D.scores[k])D.scores[k]=[];const type=T.find(x=>x.id===t);if(t==='none')D.scores[k]=[];else if(type.g==='rank'){const takenBy=isMedalTaken(D.hole,t,D.player);if(takenBy){alert('âŒ '+type.l+'ã¯æ—¢ã«'+D.cfg.names[takenBy-1]+'ãŒç²å¾—ã—ã¦ã„ã¾ã™');return}D.scores[k]=D.scores[k].filter(x=>T.find(y=>y.id===x).g!=='rank');D.scores[k].push(t)}else if(type.g==='special'){D.scores[k]=D.scores[k].filter(x=>T.find(y=>y.id===x).g!=='special');D.scores[k].push(t)}else if(type.g==='score'){D.scores[k]=D.scores[k].filter(x=>T.find(y=>y.id===x).g!=='score');D.scores[k].push(t)}else{const i=D.scores[k].indexOf(t);i>-1?D.scores[k].splice(i,1):D.scores[k].push(t)}save();render()}
function raw(h,p){const k='h'+h+'_p'+p;const sc=D.scores[k]||[];let pts=0;sc.forEach(t=>{let baseP=D.cfg.pts[t]||0;pts+=baseP;if(t==='nearpin'&&D.cfg.nikaiNearpin){const isOut=h<=9;const start=isOut?1:10;let carryCount=0;for(let prev=h-1;prev>=start;prev--){if(D.nph[prev]){let prevHas=false;for(let pp=1;pp<=D.cfg.cnt;pp++){if((D.scores['h'+prev+'_p'+pp]||[]).includes('nearpin')){prevHas=true;break}}if(!prevHas)carryCount++;else break}}pts+=carryCount*baseP}if(t==='dracon'&&D.cfg.nikaiDracon){const isOut=h<=9;const start=isOut?1:10;let carryCount=0;for(let prev=h-1;prev>=start;prev--){if(D.dch[prev]){let prevHas=false;for(let pp=1;pp<=D.cfg.cnt;pp++){if((D.scores['h'+prev+'_p'+pp]||[]).includes('dracon')){prevHas=true;break}}if(!prevHas)carryCount++;else break}}pts+=carryCount*baseP}});return pts}
function calc(h,p){const my=raw(h,p);let tot=0;for(let i=1;i<=D.cfg.cnt;i++)tot+=raw(h,i);return my*D.cfg.cnt-tot}
function tOut(p){let s=0;for(let h=1;h<=9;h++)s+=calc(h,p);return s}
function tIn(p){let s=0;for(let h=10;h<=18;h++)s+=calc(h,p);return s}
function tAll(p){return tOut(p)+tIn(p)}
function selectAvatar(idx,avatar){D.cfg.avs[idx]=avatar;D.showAvatarPicker=false;D.avatarPickerIndex=null;save();render()}
function openAvatarPicker(idx){D.showAvatarPicker=true;D.avatarPickerIndex=idx;render()}
function selectAvatar(idx,avatar){D.cfg.avs[idx]=avatar;D.showAvatarPicker=false;D.avatarPickerIndex=null;save();render()}
function openAvatarPicker(idx){D.showAvatarPicker=true;D.avatarPickerIndex=idx;render()}
function rAvatarPicker(){return`<div class="modal" onclick="if(event.target===this){D.showAvatarPicker=false;D.avatarPickerIndex=null;render()}"><div class="modal-content" onclick="event.stopPropagation()"><h2>ğŸ‘¤ ã‚¢ãƒã‚¿ãƒ¼é¸æŠ</h2><div style="display:grid;grid-template-columns:repeat(6,1fr);gap:8px;margin:20px 0;max-height:60vh;overflow-y:auto">${AVATARS.map(a=>`<button class="btn" style="font-size:32px;padding:16px;background:${D.cfg.avs[D.avatarPickerIndex]===a?'#dbeafe':'white'};border:2px solid ${D.cfg.avs[D.avatarPickerIndex]===a?'#3b82f6':'#e5e7eb'}" onclick="selectAvatar(${D.avatarPickerIndex},'${a}')">${a}</button>`).join('')}</div><button class="btn-secondary" style="width:100%" onclick="D.showAvatarPicker=false;D.avatarPickerIndex=null;render()">âœ–ï¸ é–‰ã˜ã‚‹</button></div></div>`}
function savePreset(){D.showSaveForm=true;render()}
function savePresetSubmit(){const name=D.cfg.courseName||'æœªè¨­å®š';const date=D.cfg.date.replace(/-/g,'/');const presetName=name+' '+date;const id='p'+Date.now();localStorage.setItem(id,JSON.stringify({name:presetName,courseName:D.cfg.courseName,nph:D.nph,dch:D.dch,pts:D.cfg.pts}));const list=JSON.parse(localStorage.getItem('plist')||'[]');list.unshift({id,name:presetName});localStorage.setItem('plist',JSON.stringify(list));D.showSaveForm=false;alert('âœ… ä¿å­˜: '+presetName)}
function loadP(id){const p=JSON.parse(localStorage.getItem(id));if(!p){alert('âŒ ã‚¨ãƒ©ãƒ¼');return}D.cfg.courseName=p.courseName||'';D.nph=p.nph||{};D.dch=p.dch||{};D.cfg.pts=p.pts||D.cfg.pts;D.showPresets=false;save();alert('âœ… èª­è¾¼: '+p.name)}
function delP(id){localStorage.removeItem(id);const list=JSON.parse(localStorage.getItem('plist')||'[]');localStorage.setItem('plist',JSON.stringify(list.filter(x=>x.id!==id)));render();alert('âœ… å‰Šé™¤')}
function rInput(){const cur=D.scores['h'+D.hole+'_p'+D.player]||[];const rounds=JSON.parse(localStorage.getItem('rounds_list')||'[]');let details=[];let totalPts=0;if(cur.length>0){cur.forEach(t=>{const type=T.find(x=>x.id===t);if(!type)return;let baseP=D.cfg.pts[t]||0;let actualP=baseP;let note='';if(t==='nearpin'&&D.cfg.nikaiNearpin){const isOut=D.hole<=9;const start=isOut?1:10;let carryCount=0;let carryHoles=[];for(let prev=D.hole-1;prev>=start;prev--){if(D.nph[prev]){let prevHas=false;for(let pp=1;pp<=D.cfg.cnt;pp++){if((D.scores['h'+prev+'_p'+pp]||[]).includes('nearpin')){prevHas=true;break}}if(!prevHas){carryCount++;carryHoles.push(prev)}else break}}if(carryCount>0){actualP=baseP*(carryCount+1);note=' ('+carryHoles.reverse().join('H,')+'Hè©²å½“è€…ãªã—â†’'+(carryCount+1)+'å›åˆ†)'}else{actualP=baseP}}else if(t==='dracon'&&D.cfg.nikaiDracon){const isOut=D.hole<=9;const start=isOut?1:10;let carryCount=0;let carryHoles=[];for(let prev=D.hole-1;prev>=start;prev--){if(D.dch[prev]){let prevHas=false;for(let pp=1;pp<=D.cfg.cnt;pp++){if((D.scores['h'+prev+'_p'+pp]||[]).includes('dracon')){prevHas=true;break}}if(!prevHas){carryCount++;carryHoles.push(prev)}else break}}if(carryCount>0){actualP=baseP*(carryCount+1);note=' ('+carryHoles.reverse().join('H,')+'Hè©²å½“è€…ãªã—â†’'+(carryCount+1)+'å›åˆ†)'}else{actualP=baseP}}details.push({label:type.l,points:actualP,note:note});totalPts+=actualP})}return`<div class="container"><div class="card"><div style="margin-bottom:12px;display:flex;gap:8px;align-items:center"><select class="btn" style="flex:1;font-size:14px" onchange="loadRound(this.value)"><option value="">ãƒ©ã‚¦ãƒ³ãƒ‰é¸æŠ</option>${rounds.map(r=>`<option value="${r.id}" ${D.rid===r.id?'selected':''}>${r.courseName} (${r.date})</option>`).join('')}</select><button class="btn-secondary" style="padding:12px 16px;font-size:14px" onclick="D.showRounds=true;render()">ğŸ“‚</button></div><div style="margin-bottom:16px;display:flex;gap:8px"><button class="btn-primary" style="flex:1;padding:12px;font-size:13px" onclick="newRound()">ğŸ†• æ–°è¦ä½œæˆ</button><button class="btn-secondary" style="flex:1;padding:12px;font-size:13px" onclick="D.showRoundIdInput=true;render()">ğŸ”— å‚åŠ </button></div>${D.rid?`<div style="margin-bottom:16px;padding:12px;background:#f0f9ff;border-radius:8px;border:1px solid #bae6fd"><p style="font-size:11px;color:#0369a1;margin-bottom:4px">ğŸ”— ãƒ©ã‚¦ãƒ³ãƒ‰IDï¼ˆå…±æœ‰ç”¨ï¼‰</p><div style="display:flex;gap:8px;align-items:center"><input readonly value="${D.rid}" style="flex:1;padding:8px;font-size:11px;font-family:monospace;background:white;border:1px solid #e0e7ff;border-radius:6px" onclick="this.select()"><button class="btn-secondary" style="padding:8px 12px;font-size:11px" onclick="navigator.clipboard.writeText('${D.rid}');alert('âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')">ğŸ“‹</button></div></div>`:''}<h1>${D.cfg.courseName||'ã‚´ãƒ«ãƒ•ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯'}</h1><div class="mb-6"><label class="label">ãƒ›ãƒ¼ãƒ«</label><div class="hole-scroll"><div class="hole-row">${[1,2,3,4,5,6,7,8,9].map(h=>`<button class="btn btn-hole ${D.hole===h?'active':''}" onclick="D.hole=${h};render()" style="background:${D.hole===h?'#16a34a':D.nph[h]?'#cffafe':D.dch[h]?'#f3e8ff':'#f3f4f6'};color:${D.hole===h?'white':'inherit'}">${h}${D.nph[h]?'<div class="dot dot-top"></div>':''}${D.dch[h]?'<div class="dot dot-bottom"></div>':''}</button>`).join('')}</div></div><div class="hole-scroll" style="margin-top:8px"><div class="hole-row">${[10,11,12,13,14,15,16,17,18].map(h=>`<button class="btn btn-hole ${D.hole===h?'active':''}" onclick="D.hole=${h};render()" style="background:${D.hole===h?'#16a34a':D.nph[h]?'#cffafe':D.dch[h]?'#f3e8ff':'#f3f4f6'};color:${D.hole===h?'white':'inherit'}">${h}${D.nph[h]?'<div class="dot dot-top"></div>':''}${D.dch[h]?'<div class="dot dot-bottom"></div>':''}</button>`).join('')}</div></div></div><div class="mb-6"><label class="label">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</label><div class="grid-2">${[1,2,3,4].slice(0,D.cfg.cnt).map(p=>`<button class="btn btn-player ${D.player===p?'active':''}" onclick="D.player=${p};render()"><span class="avatar">${D.cfg.avs[p-1]}</span><span>${D.cfg.names[p-1]}</span></button>`).join('')}</div></div><div><label class="label">ã‚¹ã‚³ã‚¢</label><div class="grid-5">${T.map(t=>{const sel=cur.includes(t.id);let pts=D.cfg.pts[t.id]||0;return`<button class="btn btn-score ${t.c} ${sel?'selected':''}" onclick="rec('${t.id}')"><div style="font-size:20px;margin-bottom:2px">${t.icon||''}</div><div style="font-weight:bold;font-size:11px">${t.l}</div><div style="font-size:10px;margin-top:2px">${pts>0?'+':''}${pts}</div></button>`}).join('')}</div></div>${details.length>0?`<div style="margin-top:20px;padding:16px;background:#f0fdf4;border-radius:12px;border:2px solid #86efac"><h3 style="font-size:16px;font-weight:bold;margin-bottom:12px;color:#15803d">ğŸ“Š ${D.cfg.names[D.player-1]} - ${D.hole}H ç²å¾—ãƒã‚¤ãƒ³ãƒˆ</h3><div style="display:flex;flex-direction:column;gap:8px">${details.map(d=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:8px;background:white;border-radius:8px"><span style="font-size:14px">${d.label}${d.note?'<span style="font-size:11px;color:#059669;margin-left:4px">'+d.note+'</span>':''}</span><span style="font-weight:bold;font-size:16px;color:${d.points>0?'#15803d':'#dc2626'}">${d.points>0?'+':''}${d.points}pt</span></div>`).join('')}</div><div style="margin-top:12px;padding:12px;background:#dcfce7;border-radius:8px;text-align:center"><span style="font-size:14px;color:#15803d">åˆè¨ˆï¼š</span><span style="font-weight:bold;font-size:20px;color:#15803d">${totalPts>0?'+':''}${totalPts}pt</span></div></div>`:'<div style="margin-top:20px;padding:16px;background:#f3f4f6;border-radius:12px;text-align:center;color:#6b7280"><p style="font-size:14px">ã‚¹ã‚³ã‚¢ã‚’é¸æŠã—ã¦ãã ã•ã„</p></div>'}</div></div>`}
function rList(){return`<div class="container"><div class="card overflow-x"><h2>ã‚¹ã‚³ã‚¢ä¸€è¦§</h2><table><thead><tr><th>H</th>${[1,2,3,4].slice(0,D.cfg.cnt).map(p=>`<th>${D.cfg.avs[p-1]}<br>${D.cfg.names[p-1]}</th>`).join('')}</tr></thead><tbody>${[1,2,3,4,5,6,7,8,9].map(h=>`<tr class="${D.nph[h]?'bg-cyan-100':D.dch[h]?'bg-purple-100':''}"><td>${h}${D.nph[h]?' ğŸ¯':''}${D.dch[h]?' ğŸŒï¸':''}</td>${[1,2,3,4].slice(0,D.cfg.cnt).map(p=>{const pts=calc(h,p);return`<td class="clickable ${pts>0?'bg-green-100':pts<0?'bg-red-100':''}" onclick="D.hole=${h};D.player=${p};D.view='input';render()">${pts>0?'+':''}${pts}</td>`}).join('')}</tr>`).join('')}<tr class="bg-yellow-100"><td><b>OUT</b></td>${[1,2,3,4].slice(0,D.cfg.cnt).map(p=>{const t=tOut(p);return`<td><b>${t>0?'+':''}${t}</b></td>`}).join('')}</tr>${[10,11,12,13,14,15,16,17,18].map(h=>`<tr class="${D.nph[h]?'bg-cyan-100':D.dch[h]?'bg-purple-100':''}"><td>${h}${D.nph[h]?' ğŸ¯':''}${D.dch[h]?' ğŸŒï¸':''}</td>${[1,2,3,4].slice(0,D.cfg.cnt).map(p=>{const pts=calc(h,p);return`<td class="clickable ${pts>0?'bg-green-100':pts<0?'bg-red-100':''}" onclick="D.hole=${h};D.player=${p};D.view='input';render()">${pts>0?'+':''}${pts}</td>`}).join('')}</tr>`).join('')}<tr class="bg-yellow-100"><td><b>IN</b></td>${[1,2,3,4].slice(0,D.cfg.cnt).map(p=>{const t=tIn(p);return`<td><b>${t>0?'+':''}${t}</b></td>`}).join('')}</tr><tr class="bg-blue-100"><td><b>TOTAL</b></td>${[1,2,3,4].slice(0,D.cfg.cnt).map(p=>{const t=tAll(p);return`<td><b>${t>0?'+':''}${t}</b></td>`}).join('')}</tr></tbody></table></div></div>`}
function rSet(){return`<div class="container"><div class="card"><h2>è¨­å®š</h2><div class="mb-6"><label class="label">ã‚´ãƒ«ãƒ•å ´å</label><input class="input-full" value="${D.cfg.courseName}" oninput="D.cfg.courseName=this.value;save()"></div><div class="mb-6"><label class="label">ãƒ©ã‚¦ãƒ³ãƒ‰æ—¥</label><input type="date" class="input-full" value="${D.cfg.date}" onchange="D.cfg.date=this.value;save();render()"></div><div class="mb-6"><label class="label">äººæ•°</label><div class="flex flex-gap">${[2,3,4].map(n=>`<button class="btn btn-count ${D.cfg.cnt===n?'active':''}" onclick="D.cfg.cnt=${n};save();render()">${n}äºº</button>`).join('')}</div></div><div class="mb-6"><label class="label">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</label><div class="space-y">${[0,1,2,3].slice(0,D.cfg.cnt).map(i=>`<div class="flex flex-gap"><button class="btn" style="font-size:24px;min-width:60px;padding:12px" onclick="openAvatarPicker(${i})">${D.cfg.avs[i]}</button><input class="input-full" value="${D.cfg.names[i]}" oninput="D.cfg.names[${i}]=this.value;save()"></div>`).join('')}</div></div><div class="mb-6" style="background:#fef3c7;padding:16px;border-radius:12px"><label class="label" style="margin-bottom:12px">ğŸ” ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼</label><p style="font-size:12px;color:#92400e;margin-bottom:12px">è©²å½“è€…ãªã—ã®å›æ•°åˆ†ã‚’ç´¯ç©ã—ã€æ¬¡ã«å–ã£ãŸäººãŒå…¨ã¦ç²å¾—ã—ã¾ã™ï¼ˆOUT/INç‹¬ç«‹ï¼‰</p><div class="space-y" style="gap:8px"><label style="display:flex;align-items:center;gap:8px;padding:8px;background:white;border-radius:8px"><input type="checkbox" ${D.cfg.nikaiNearpin?'checked':''} onchange="D.cfg.nikaiNearpin=this.checked;save();render()" style="width:20px;height:20px"><span>ãƒ‹ã‚¢ãƒ”ãƒ³ ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼</span></label><label style="display:flex;align-items:center;gap:8px;padding:8px;background:white;border-radius:8px"><input type="checkbox" ${D.cfg.nikaiDracon?'checked':''} onchange="D.cfg.nikaiDracon=this.checked;save();render()" style="width:20px;height:20px"><span>ãƒ‰ãƒ©ã‚³ãƒ³ ã‚­ãƒ£ãƒªãƒ¼ã‚ªãƒ¼ãƒãƒ¼</span></label></div></div><div class="mb-6" style="background:#e0f2fe;padding:16px;border-radius:12px"><label class="label" style="margin-bottom:12px">â˜ï¸ Google Sheets é€£æº</label><div style="margin-bottom:12px"><p style="font-size:13px;color:#0369a1;margin-bottom:8px">${D.apiUrl?'âœ… é€£æºæ¸ˆã¿ï¼ˆè‡ªå‹•ä¿å­˜ONï¼‰':'âŒ æœªè¨­å®š'}</p><p style="font-size:11px;color:#64748b">ã‚¹ã‚³ã‚¢å…¥åŠ›æ™‚ã«è‡ªå‹•çš„ã«Google Sheetsã«ä¿å­˜ã•ã‚Œã¾ã™</p></div><div class="flex flex-gap"><button class="btn-primary" onclick="D.showApiSetup=true;render()">${D.apiUrl?'âš™ï¸ å†è¨­å®š':'âš™ï¸ è¨­å®š'}</button></div></div><div class="mb-6" style="background:#cffafe;padding:16px;border-radius:12px"><label class="label" style="margin-bottom:12px">ğŸ¯ ãƒ‹ã‚¢ãƒ”ãƒ³ãƒ›ãƒ¼ãƒ«</label><div class="hole-scroll"><div class="hole-row">${[1,2,3,4,5,6,7,8,9].map(h=>`<button class="btn btn-hole" onclick="D.nph[${h}]=!D.nph[${h}];if(D.nph[${h}])D.dch[${h}]=false;save();render()" style="background:${D.nph[h]?'#06b6d4':'#f3f4f6'};color:${D.nph[h]?'white':'inherit'}">${h}</button>`).join('')}</div></div><div class="hole-scroll" style="margin-top:8px"><div class="hole-row">${[10,11,12,13,14,15,16,17,18].map(h=>`<button class="btn btn-hole" onclick="D.nph[${h}]=!D.nph[${h}];if(D.nph[${h}])D.dch[${h}]=false;save();render()" style="background:${D.nph[h]?'#06b6d4':'#f3f4f6'};color:${D.nph[h]?'white':'inherit'}">${h}</button>`).join('')}</div></div></div><div class="mb-6" style="background:#f3e8ff;padding:16px;border-radius:12px"><label class="label" style="margin-bottom:12px">ğŸŒï¸ ãƒ‰ãƒ©ã‚³ãƒ³ãƒ›ãƒ¼ãƒ«</label><div class="hole-scroll"><div class="hole-row">${[1,2,3,4,5,6,7,8,9].map(h=>`<button class="btn btn-hole" onclick="D.dch[${h}]=!D.dch[${h}];if(D.dch[${h}])D.nph[${h}]=false;save();render()" style="background:${D.dch[h]?'#a855f7':'#f3f4f6'};color:${D.dch[h]?'white':'inherit'}">${h}</button>`).join('')}</div></div><div class="hole-scroll" style="margin-top:8px"><div class="hole-row">${[10,11,12,13,14,15,16,17,18].map(h=>`<button class="btn btn-hole" onclick="D.dch[${h}]=!D.dch[${h}];if(D.dch[${h}])D.nph[${h}]=false;save();render()" style="background:${D.dch[h]?'#a855f7':'#f3f4f6'};color:${D.dch[h]?'white':'inherit'}">${h}</button>`).join('')}</div></div></div><div class="mb-6"><label class="label">ãƒ—ãƒªã‚»ãƒƒãƒˆ</label><div class="flex flex-gap"><button class="btn-primary" onclick="D.showPresets=true;render()">ğŸ“‚ èª­è¾¼</button><button class="btn-secondary" onclick="savePreset()">ğŸ’¾ ä¿å­˜</button></div></div><div class="bg-gray-50 mb-6"><h2>ç‚¹æ•°</h2><div class="space-y">${T.filter(t=>t.id!=='none').map(t=>`<div class="flex flex-gap" style="align-items:center"><div class="btn ${t.c}" style="min-width:100px;color:white;font-size:14px">${t.l}</div><input type="number" class="btn" style="width:70px;text-align:center" value="${D.cfg.pts[t.id]}" onchange="D.cfg.pts['${t.id}']=parseInt(this.value)||0;save()"><span>pt</span></div>`).join('')}</div></div><button class="btn-reset" onclick="D.scores={};D.nph={};D.dch={};save();alert('âœ… ãƒªã‚»ãƒƒãƒˆå®Œäº†')">ğŸ—‘ ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆ</button></div></div>`}
function rPresets(){const list=JSON.parse(localStorage.getItem('plist')||'[]');return`<div class="modal" onclick="if(event.target===this){D.showPresets=false;render()}"><div class="modal-content" onclick="event.stopPropagation()"><h2>ğŸŒï¸ ãƒ—ãƒªã‚»ãƒƒãƒˆ</h2><div style="max-height:55vh;overflow-y:auto;margin:20px 0">${list.length===0?'<p style="color:#6b7280;padding:40px 20px;text-align:center">ãƒ‡ãƒ¼ã‚¿ãªã—</p>':''}${list.map(p=>`<div class="preset-item"><div class="preset-name">${p.name}</div><div class="preset-btns"><button class="btn-load" onclick="event.stopPropagation();loadP('${p.id}')">ğŸ“¥ èª­è¾¼</button><button class="btn-del" onclick="event.stopPropagation();delP('${p.id}')">ğŸ—‘</button></div></div>`).join('')}</div><button class="btn-secondary" style="width:100%" onclick="D.showPresets=false;render()">âœ–ï¸ é–‰ã˜ã‚‹</button></div></div>`}
function rSaveForm(){const name=D.cfg.courseName||'æœªè¨­å®š';const date=D.cfg.date.replace(/-/g,'/');const presetName=name+' '+date;return`<div class="modal" onclick="if(event.target===this){D.showSaveForm=false;render()}"><div class="modal-content" onclick="event.stopPropagation()"><h2>ğŸ’¾ ãƒ—ãƒªã‚»ãƒƒãƒˆä¿å­˜</h2><div style="margin:20px 0;padding:20px;background:#f3f4f6;border-radius:12px;text-align:center"><p style="color:#6b7280;margin-bottom:8px;font-size:14px">ä¿å­˜ã™ã‚‹è¨­å®šå</p><p style="font-size:18px;font-weight:bold">${presetName}</p></div><div style="display:flex;gap:12px"><button class="btn-secondary" style="flex:1" onclick="D.showSaveForm=false;render()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button><button class="btn-primary" style="flex:1" onclick="savePresetSubmit()">ä¿å­˜</button></div></div></div>`}
function rRounds(){const list=JSON.parse(localStorage.getItem('rounds_list')||'[]');return`<div class="modal" onclick="if(event.target===this){D.showRounds=false;render()}"><div class="modal-content" onclick="event.stopPropagation()"><h2>ğŸ“‚ ãƒ©ã‚¦ãƒ³ãƒ‰ç®¡ç†</h2><div style="max-height:55vh;overflow-y:auto;margin:20px 0">${list.length===0?'<p style="color:#6b7280;padding:40px 20px;text-align:center">ãƒ‡ãƒ¼ã‚¿ãªã—</p>':''}${list.map(r=>`<div class="preset-item"><div class="preset-name">${r.courseName} (${r.date})</div><div class="preset-btns"><button class="btn-load" onclick="event.stopPropagation();loadRound('${r.id}');D.showRounds=false">ğŸ“¥ èª­è¾¼</button><button class="btn-del" onclick="event.stopPropagation();deleteRound('${r.id}')">ğŸ—‘</button></div></div>`).join('')}</div><button class="btn-secondary" style="width:100%" onclick="D.showRounds=false;render()">âœ–ï¸ é–‰ã˜ã‚‹</button></div></div>`}
function rApiSetup(){return`<div class="modal" onclick="if(event.target===this){D.showApiSetup=false;render()}"><div class="modal-content" onclick="event.stopPropagation()"><h2>â˜ï¸ Google Sheets API è¨­å®š</h2><div style="margin:20px 0"><p style="font-size:13px;color:#6b7280;margin-bottom:12px">Google Apps Scriptã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p><input id="apiUrlInput" class="input-full" placeholder="https://script.google.com/macros/s/.../exec" value="${D.apiUrl}" style="font-size:14px;font-family:monospace"></div><div style="background:#fef3c7;padding:12px;border-radius:8px;margin-bottom:16px"><p style="font-size:12px;color:#92400e">ğŸ“– <a href="sheets-setup.md" target="_blank" style="color:#92400e;text-decoration:underline">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã‚’è¦‹ã‚‹</a></p></div><div style="display:flex;gap:12px"><button class="btn-secondary" style="flex:1" onclick="D.showApiSetup=false;render()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button><button class="btn-primary" style="flex:1" onclick="setApiUrl()">ä¿å­˜</button></div></div></div>`}
function rRoundIdInput(){return`<div class="modal" onclick="if(event.target===this){D.showRoundIdInput=false;render()}"><div class="modal-content" onclick="event.stopPropagation()"><h2>ğŸ”— ãƒ©ã‚¦ãƒ³ãƒ‰ã«å‚åŠ </h2><div style="margin:20px 0"><p style="font-size:13px;color:#6b7280;margin-bottom:12px">ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰å…±æœ‰ã•ã‚ŒãŸãƒ©ã‚¦ãƒ³ãƒ‰IDã‚’å…¥åŠ›</p><input id="roundIdInput" class="input-full" placeholder="round_1234567890123" style="font-size:14px;font-family:monospace"></div><div style="background:#e0f2fe;padding:12px;border-radius:8px;margin-bottom:16px"><p style="font-size:12px;color:#0369a1">ğŸ’¡ åŒã˜ãƒ©ã‚¦ãƒ³ãƒ‰IDã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€å…¨å“¡ãŒåŒã˜ã‚¹ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã§ãã¾ã™</p></div><div style="display:flex;gap:12px"><button class="btn-secondary" style="flex:1" onclick="D.showRoundIdInput=false;render()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button><button class="btn-primary" style="flex:1" onclick="joinRound()">å‚åŠ </button></div></div></div>`}
function render(){const v={input:rInput,list:rList,settings:rSet};let h=v[D.view]();if(D.showPresets)h+=rPresets();if(D.showSaveForm)h+=rSaveForm();if(D.showRounds)h+=rRounds();if(D.showApiSetup)h+=rApiSetup();if(D.showRoundIdInput)h+=rRoundIdInput();if(D.showAvatarPicker)h+=rAvatarPicker();if(D.alert)h+=`<div class="alert">${D.alert}</div>`;h+=`<div class="nav"><button class="nav-btn ${D.view==='input'?'active':''}" onclick="D.view='input';render()"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg><span>å…¥åŠ›</span></button><button class="nav-btn ${D.view==='list'?'active':''}" onclick="D.view='list';render()"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg><span>ä¸€è¦§</span></button><button class="nav-btn ${D.view==='settings'?'active':''}" onclick="D.view='settings';render()"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg><span>è¨­å®š</span></button></div>`;document.getElementById('app').innerHTML=h}
D.rid='r1';D.view='settings';newRound();render();
// Service Workerç™»éŒ²
if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js').then(()=>console.log('SW registered')).catch(e=>console.log('SW error:',e))}
</script>
</body>
</html>
