# Firebase Realtime Database 統合完了

## 実装した機能

### ✅ リアルタイム同期
- スコア入力時に自動的にFirebaseに保存
- 他のデバイスでもリアルタイムで反映
- 全員が同じスコアを共有

### ✅ データの流れ

**新規ラウンド作成時：**
1. ラウンドID生成（例：round_1733652000000）
2. Firebaseにラウンドデータを保存
3. リアルタイム監視を開始

**ラウンドに参加時：**
1. ラウンドIDを入力
2. Firebaseからデータを取得
3. 設定・スコアを自動的に読み込み
4. リアルタイム監視を開始

**スコア入力時：**
1. ローカルで即座に反映
2. Firebaseに自動保存
3. 他のデバイスがリアルタイムで受信
4. 自動的に画面更新

### ✅ 3層バックアップ

1. **Firebase Realtime Database**（メイン・リアルタイム）
2. **Google Sheets**（バックアップ・手動確認用）
3. **LocalStorage**（オフライン時・キャッシュ）

## 使い方

### プレイヤー1（ラウンド作成者）
1. 「🆕 新規作成」をタップ
2. ラウンドIDをコピー（例：round_1733652000000）
3. LINEなどで他のプレイヤーに共有
4. スコアを入力開始

### プレイヤー2〜4（参加者）
1. 「🔗 参加」をタップ
2. 共有されたラウンドIDを貼り付け
3. 「参加」をタップ
4. 自動的に設定・スコアが同期される
5. スコアを入力開始

### リアルタイム同期の確認
- 誰かがスコアを入力すると、全員の画面に即座に反映
- 一覧画面でポイント合計も自動更新
- オフラインでも動作（再接続時に自動同期）

## Firebaseデータ構造

```
rounds/
  └── round_1733652000000/
      ├── cfg/
      │   ├── courseName: "〇〇ゴルフクラブ"
      │   ├── date: "2024-12-08"
      │   ├── cnt: 4
      │   ├── names: ["P1", "P2", "P3", "P4"]
      │   └── pts: { gold: 3, silver: 2, ... }
      ├── scores/
      │   ├── h1_p1: ["gold", "birdie"]
      │   ├── h1_p2: ["silver"]
      │   └── ...
      ├── nph/
      │   ├── 3: true
      │   └── 5: true
      ├── dch/
      │   ├── 2: true
      │   └── 4: true
      └── updatedAt: 1733652123456
```

## セキュリティルール設定（推奨）

現在はテストモードで全員が読み書き可能ですが、本番運用時は以下のルールを推奨：

```json
{
  "rules": {
    "rounds": {
      "$roundId": {
        ".read": true,
        ".write": true
      }
    }
  }
}
```

より厳格なルール（認証必須）:
```json
{
  "rules": {
    "rounds": {
      "$roundId": {
        ".read": "auth != null",
        ".write": "auth != null"
      }
    }
  }
}
```

## トラブルシューティング

### スコアが同期されない
- ブラウザのコンソールを開いてエラーを確認
- "Firebase保存完了" が表示されるか確認
- インターネット接続を確認

### 他の人のスコアが見えない
- 同じラウンドIDを使用しているか確認
- ラウンドIDを再入力して「参加」し直す
- ページをリロード

### データが消えた
- Firebase コンソールで直接確認
- Google Sheets バックアップを確認
- LocalStorage にもバックアップあり

## Firebase コンソールでの確認方法

1. https://console.firebase.google.com/
2. プロジェクト「golf-olympic」を選択
3. 左メニュー「Realtime Database」
4. データタブでリアルタイムにデータを確認可能

## 今後の拡張案

- 🔐 認証機能（Google/匿名ログイン）
- 📊 過去のラウンド履歴一覧
- 📈 統計・グラフ表示
- 🏆 リーダーボード
- 📱 プッシュ通知
- 💬 チャット機能

## 注意事項

- Firebase無料プランの制限：
  - 同時接続数：100
  - ストレージ：1GB
  - ダウンロード：10GB/月
- ゴルフオリンピックアプリの使用量なら十分
