# ゴルフオリンピック スコア管理アプリ

ゴルフラウンド中のスコアをリアルタイムで共有・管理できるWebアプリケーションです。オリンピック方式のポイント計算とストロークスコア（ハンディキャップ）の両方に対応しています。

## 🎯 主な機能

### オリンピックスコア管理
- **18ホール対応**: OUT/IN 各9ホールのスコア記録
- **複数プレイヤー**: 2〜4人まで対応
- **ポイント制**: 金メダル、銀メダル、銅メダル、鉄、ダイヤモンド、イーグル、バーディー、ニアピン、ドラコンなど多彩なスコアタイプ
- **オリンピック計算**: プレイヤースコア × 人数 - 全員の合計スコア
- **リアルタイム同期**: Firebase Realtime Databaseによる即座のデータ共有

### ハンディキャップ計算機能 🆕
- **ストロークスコア管理**: OUT/IN/TOTALのストローク入力
- **ハンディキャップ調整**: プレイヤーペアごとに-18〜+18の範囲で設定可能
- **動的ペアリング**: 2人戦、3人戦（3組）、4人戦（6組）に自動対応
- **グローバル履歴管理**: プレイヤー名ベースで過去のハンディキャップを自動復元
- **勝敗判定**: OUT/IN/TOTALそれぞれで勝敗を表示
- **次回ハンディキャップ自動計算**: 結果に基づいて次回の推奨値を算出

### ラウンド管理
- **ラウンドID共有**: 固有のIDを共有して複数人で同じラウンドに参加
- **履歴機能**: 過去に参加したラウンドIDをサジェスト表示
- **キャリーオーバー**: ニアピン・ドラコンの該当者なしを次ホールに繰越
- **ニアピン/ドラコンホール設定**: 任意のホールに設定可能
- **一括データ管理**: オリンピックスコアとハンディキャップを同一ラウンドで管理

### ユーザー管理
- **Google認証**: Googleアカウントでログイン
- **承認制**: 管理者による承認後に利用可能
- **管理者機能**: ユーザーの承認・却下、管理者権限の付与

### その他
- **プリセット保存**: コース設定やポイント設定を保存・読込
- **プレイヤーカスタマイズ**: アバター・名前の変更
- **レスポンシブデザイン**: モバイル・デスクトップ両対応
- **デバッグモード**: モバイルプレビュー用の認証バイパス機能

## 🚀 デモ

https://guncys-inc.github.io/olympic_score/

## 📋 必要要件

- モダンブラウザ（Chrome, Firefox, Safari, Edge 最新版）
- インターネット接続（Firebase利用のため）
- Googleアカウント（認証用）

## 🔧 セットアップ

### Firebaseプロジェクトの作成

1. [Firebase Console](https://console.firebase.google.com/) でプロジェクトを作成
2. Authentication で Google プロバイダを有効化
3. Realtime Database を作成（テストモードで開始可）
4. プロジェクト設定から Firebase SDK 設定情報を取得

### 設定ファイルの編集

`index.html` の Firebase設定部分を編集：

```javascript
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
```

### デバッグモードの切り替え

開発時やモバイルプレビューで認証をスキップしたい場合：

```javascript
// index.html の165行目付近
DEBUG_BYPASS_AUTH: true  // デバッグモード（認証スキップ）
DEBUG_BYPASS_AUTH: false // 本番モード（認証必須）
```

### デプロイ

#### GitHub Pagesにデプロイ

1. GitHubリポジトリを作成
2. `index.html` をリポジトリにプッシュ
3. Settings → Pages → Source を `main` ブランチに設定
4. 数分後に `https://USERNAME.github.io/REPOSITORY_NAME/` でアクセス可能

#### ローカルで実行

```bash
# シンプルなHTTPサーバーを起動
python -m http.server 8000
# または
npx http-server
```

ブラウザで `http://localhost:8000` にアクセス

## 📱 使い方

### 初回利用

1. アプリにアクセス
2. Googleアカウントでログイン
3. 管理者に承認をリクエスト（画面に表示されるメールアドレスを管理者に共有）
4. 承認後、アプリが利用可能に

### ラウンド作成

1. 「設定」タブを開く
2. 「🆕 新規作成」ボタンをタップ
3. ゴルフ場名、日付、プレイヤー名を設定
4. ニアピン・ドラコンホールを設定
5. 表示されるラウンドIDを他のプレイヤーと共有

### ラウンド参加

1. 「設定」タブを開く
2. 「🔗 参加」ボタンをタップ
3. 共有されたラウンドIDを入力（過去の履歴から選択も可能）
4. 「参加」ボタンをタップ

### オリンピックスコア入力

1. 「入力」タブでホール番号を選択
2. プレイヤーを選択
3. 該当するスコアボタンをタップ
4. 獲得ポイントが自動計算され表示

### ハンディキャップ機能の使い方

#### 基本的な流れ

1. **「ハンディキャップ」タブを開く**
   - プレイヤー設定から名前が自動同期されます

2. **ハンディキャップ設定**
   - スライダーでプレイヤーペアごとに-18〜+18の範囲で調整
   - 左側がマイナス = 左プレイヤーが有利
   - 右側がプラス = 右プレイヤーが有利
   - 中央 = スクラッチ（ハンディキャップなし）
   - 過去の対戦履歴がある場合は自動的に復元されます

3. **ストロークスコア入力**
   - OUT（前半9ホール）のスコアを入力
   - IN（後半9ホール）のスコアを入力
   - TOTALが自動計算されます

4. **結果確認**
   - ハンディキャップ適用後のスコアで勝敗を表示
   - OUT/IN/TOTALそれぞれの結果を色分け表示
     - 緑 = 勝ち
     - 赤 = 負け
     - オレンジ = 引き分け
   - 次回の推奨ハンディキャップも表示

5. **記録保存**
   - 「📝 記録を保存」で履歴に保存
   - 「✅ 次回ハンディキャップを適用」で次回用に設定

6. **次回のラウンド**
   - 同じプレイヤー名で開始すると前回のハンディキャップが自動復元
   - プレイヤー数が変わっても既存ペアの履歴は保持

#### ハンディキャップの自動復元例

```
初回: 太郎 vs 次郎 = スクラッチ（0）
2回目: 太郎 vs 次郎 → 自動的に前回の値を復元
3人戦: 太郎 vs 次郎 vs 三郎 → 太郎 vs 次郎は復元、他は新規
4人戦: 人数増加 → 既存ペアはすべて復元
```

### スコア確認

1. 「一覧」タブで全プレイヤーのオリンピックスコアを確認
2. OUT、IN、TOTALのポイントを一目で把握
3. 最終順位を確認

## 🔐 セキュリティ

### Firebase Realtime Database ルール例

```json
{
  "rules": {
    "rounds": {
      ".read": "auth != null && root.child('authorized_users').child(auth.uid).child('isAdmin').val() === true",
      "$roundId": {
        ".read": "auth != null",
        ".write": "auth != null && (
          root.child('authorized_users').child(auth.uid).child('isAdmin').val() === true ||
          !data.exists()
        )"
      }
    },
    "globalHandicaps": {
      ".read": "auth != null",
      ".write": "auth != null"
    },
    "authorized_users": {
      ".read": "auth != null",
      "$uid": {
        ".write": "auth != null && (
          !data.exists() ||
          root.child('authorized_users').child(auth.uid).child('isAdmin').val() === true
        )"
      }
    }
  }
}
```

## 🛠 技術スタック

- **フロントエンド**: Vanilla JavaScript, HTML5, CSS3
- **認証**: Firebase Authentication (Google)
- **データベース**: Firebase Realtime Database
- **ホスティング**: GitHub Pages
- **デザイン**: レスポンシブデザイン、モバイルファースト
- **データ構造**: 
  - `rounds/{roundId}`: ラウンドデータ（オリンピックスコア + ハンディキャップ）
  - `globalHandicaps`: プレイヤーペアの永続的なハンディキャップ履歴

## 🆕 最新の更新内容

### v2.0.0 - ハンディキャップ機能追加
- ストロークスコア管理機能
- ハンディキャップ計算機能（-18〜+18）
- プレイヤー名ベースのグローバル履歴管理
- 動的ペアリング（2〜4人対応）
- 勝敗判定とビジュアル表示
- 次回ハンディキャップ自動計算

### v1.5.0 - UI/UX改善
- スコア入力欄のフォーカス問題修正
- 数値入力欄の矢印ボタン削除
- スライダーのドラッグ操作を滑らかに改善
- レスポンシブデザイン最適化

### v1.4.0 - デバッグモード追加
- モバイルプレビュー用の認証バイパス機能
- デバッグモード切り替えUI

## 📝 ライセンス

MIT License - 詳細は [LICENSE](LICENSE) を参照

## 🤝 コントリビューション

プルリクエストを歓迎します。大きな変更の場合は、まずissueを開いて変更内容を議論してください。

## 📧 お問い合わせ

問題や提案がある場合は、GitHubのIssueを作成してください。

## 🙏 謝辞

- Firebase による素晴らしいバックエンドサービス
- すべてのコントリビューター

---

**注意**: 本アプリケーションは個人利用・小規模グループでの利用を想定しています。大規模な利用の場合は、Firebaseのプランや料金に注意してください。
